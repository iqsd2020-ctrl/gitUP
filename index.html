<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>GitHub Manager Ultra - Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù…Ø³ØªÙ‚Ø±Ø©</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&family=Fira+Code:wght@400;500&display=swap');
        
        :root {
            --gh-bg: #0d1117;
            --gh-card: #161b22;
            --gh-border: #30363d;
            --gh-text: #c9d1d9;
        }

        body {
            background-color: var(--gh-bg);
            color: var(--gh-text);
            font-family: 'Cairo', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }

        .terminal-font { font-family: 'Fira Code', monospace; }

        /* ØªØ®ØµÙŠØµ Ø§Ù„ØªÙ…Ø±ÙŠØ± */
        ::-webkit-scrollbar { width: 4px; height: 4px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #30363d; border-radius: 10px; }

        /* Ø­Ø±ÙƒØ§Øª Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ */
        .sidebar-transition { transition: transform 0.3s ease-in-out, width 0.3s ease-in-out; }
        
        .active-tab {
            background-color: #21262d;
            border-right: 4px solid #2f81f7;
            color: #ffffff;
        }

        .tab-content { display: none; }
        .tab-content.active { display: block; animation: fadeIn 0.3s ease-out; }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„Ù„Ù…Ø³ Ù„Ù„Ù‡Ø§ØªÙ */
        input, button { font-size: 16px !important; } /* ØªÙ…Ù†Ø¹ Ø§Ù„Ø²ÙˆÙˆÙ… Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ ÙÙŠ Ø¢ÙŠÙÙˆÙ† */
        
        .terminal-height { height: 120px; }
        @media (min-width: 768px) { .terminal-height { height: 160px; } }
    </style>
</head>
<body class="overflow-hidden">

    <!-- Backdrop for Mobile Sidebar -->
    <div id="sidebarBackdrop" onclick="toggleSidebar()" class="fixed inset-0 bg-black/50 z-40 hidden md:hidden"></div>

    <div class="flex h-screen overflow-hidden">
        
        <!-- Sidebar -->
        <aside id="sidebar" class="fixed inset-y-0 right-0 w-64 bg-[#161b22] border-l border-[#30363d] z-50 transform translate-x-full md:translate-x-0 sidebar-transition md:relative">
            <div class="flex flex-col h-full">
                <div class="p-5 border-b border-[#30363d] flex items-center justify-between">
                    <span class="font-bold text-lg flex items-center gap-2 text-white">
                        <i class="fab fa-github text-2xl"></i> GitHub Pro
                    </span>
                    <button onclick="toggleSidebar()" class="md:hidden text-gray-400">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
                
                <nav class="flex-1 p-3 space-y-1 overflow-y-auto">
                    <button onclick="showTab('dashboard')" class="nav-item w-full flex items-center gap-3 p-3 rounded-lg hover:bg-[#21262d] transition-all text-sm active-tab" id="btn-dashboard">
                        <i class="fas fa-chart-pie w-5"></i> Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
                    </button>
                    <button onclick="showTab('explorer')" class="nav-item w-full flex items-center gap-3 p-3 rounded-lg hover:bg-[#21262d] transition-all text-sm" id="btn-explorer">
                        <i class="fas fa-search w-5"></i> Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹Ø§Øª
                    </button>
                    <button onclick="showTab('uploader')" class="nav-item w-full flex items-center gap-3 p-3 rounded-lg hover:bg-[#21262d] transition-all text-sm" id="btn-uploader">
                        <i class="fas fa-cloud-upload-alt w-5"></i> Ø±ÙØ¹ ÙˆØªØ­Ø¯ÙŠØ«
                    </button>
                    <button onclick="showTab('gists')" class="nav-item w-full flex items-center gap-3 p-3 rounded-lg hover:bg-[#21262d] transition-all text-sm" id="btn-gists">
                        <i class="fas fa-code w-5"></i> Ø§Ù„Ù‚ØµØ§ØµØ§Øª (Gists)
                    </button>
                    <div class="pt-4 pb-2 px-3 text-[10px] text-gray-500 font-bold uppercase tracking-widest">Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</div>
                    <button onclick="showTab('settings')" class="nav-item w-full flex items-center gap-3 p-3 rounded-lg hover:bg-[#21262d] transition-all text-sm" id="btn-settings">
                        <i class="fas fa-cog w-5"></i> Ø§Ù„Ø¶Ø¨Ø·
                    </button>
                </nav>

                <div id="sidebarUser" class="p-4 border-t border-[#30363d] bg-[#0d1117]/50 hidden">
                    <div class="flex items-center gap-3">
                        <img id="userAvatar" src="" class="w-10 h-10 rounded-full border border-[#30363d]">
                        <div class="overflow-hidden">
                            <div id="userLogin" class="text-sm font-bold text-white truncate">Username</div>
                            <div id="userType" class="text-[10px] text-gray-500 uppercase">Pro User</div>
                        </div>
                    </div>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="flex-1 flex flex-col min-w-0">
            
            <!-- Header -->
            <header class="h-14 md:h-16 bg-[#161b22] border-b border-[#30363d] flex items-center justify-between px-4 md:px-6 sticky top-0 z-30">
                <div class="flex items-center gap-3">
                    <button onclick="toggleSidebar()" class="md:hidden p-2 -mr-2 text-gray-400">
                        <i class="fas fa-bars text-xl"></i>
                    </button>
                    <div id="currentRepoBadge" class="hidden md:flex items-center gap-2 bg-blue-500/10 border border-blue-500/30 px-3 py-1 rounded-full text-blue-400 text-[11px] font-bold">
                        <i class="fas fa-box"></i> <span id="selectedRepoName">Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹</span>
                        <i class="fas fa-times cursor-pointer hover:text-white" onclick="deselectRepo()"></i>
                    </div>
                </div>

                <div class="flex items-center gap-2">
                    <div class="relative group hidden sm:flex">
                        <input type="password" id="tokenInput" placeholder="Token" class="bg-[#0d1117] border border-[#30363d] rounded-l px-3 py-1.5 text-xs w-32 md:w-48 focus:w-60 transition-all text-white">
                        <button onclick="validateToken()" class="bg-blue-600 px-3 py-1.5 rounded-r hover:bg-blue-500 text-xs font-bold text-white flex items-center gap-1">
                            <i class="fas fa-sync-alt" id="syncIcon"></i> <span class="hidden md:inline">Ø§ØªØµØ§Ù„</span>
                        </button>
                    </div>
                    <!-- Mobile Connect Button -->
                    <button onclick="openTokenModal()" class="sm:hidden p-2 text-blue-500">
                        <i class="fas fa-key text-lg"></i>
                    </button>
                </div>
            </header>

            <!-- Scrollable Body -->
            <div class="flex-1 overflow-y-auto p-4 md:p-8 pb-40">
                
                <!-- Dashboard Tab -->
                <div id="tab-dashboard" class="tab-content active space-y-6">
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-3 md:gap-4">
                        <div class="bg-[#161b22] p-4 rounded-xl border border-[#30363d] flex flex-col items-center justify-center text-center">
                            <i class="fas fa-folder text-blue-500 text-xl mb-2"></i>
                            <div class="text-xl font-bold text-white" id="stat-repos">0</div>
                            <div class="text-[10px] text-gray-500 font-bold uppercase">Ù…Ø³ØªÙˆØ¯Ø¹</div>
                        </div>
                        <div class="bg-[#161b22] p-4 rounded-xl border border-[#30363d] flex flex-col items-center justify-center text-center">
                            <i class="fas fa-users text-green-500 text-xl mb-2"></i>
                            <div class="text-xl font-bold text-white" id="stat-followers">0</div>
                            <div class="text-[10px] text-gray-500 font-bold uppercase">Ù…ØªØ§Ø¨Ø¹</div>
                        </div>
                        <div class="bg-[#161b22] p-4 rounded-xl border border-[#30363d] flex flex-col items-center justify-center text-center">
                            <i class="fas fa-code text-purple-500 text-xl mb-2"></i>
                            <div class="text-xl font-bold text-white" id="stat-gists">0</div>
                            <div class="text-[10px] text-gray-500 font-bold uppercase">Ù‚ØµØ§ØµØ§Øª</div>
                        </div>
                        <div class="bg-[#161b22] p-4 rounded-xl border border-[#30363d] flex flex-col items-center justify-center text-center">
                            <i class="fas fa-star text-yellow-500 text-xl mb-2"></i>
                            <div class="text-xl font-bold text-white" id="stat-stars">0</div>
                            <div class="text-[10px] text-gray-500 font-bold uppercase">Ù†Ø¬Ù…Ø©</div>
                        </div>
                    </div>

                    <div id="userCard" class="bg-[#161b22] border border-[#30363d] p-6 rounded-2xl hidden md:flex flex-row items-center gap-8 shadow-xl">
                        <!-- Content injected by JS -->
                    </div>
                    
                    <!-- Mobile Profile View -->
                    <div id="userCardMobile" class="md:hidden bg-[#161b22] border border-[#30363d] p-5 rounded-2xl flex flex-col items-center text-center gap-4">
                        <!-- Content injected by JS -->
                    </div>
                </div>

                <!-- Explorer Tab -->
                <div id="tab-explorer" class="tab-content space-y-6">
                    <div class="flex justify-between items-center px-1">
                        <h2 class="text-lg font-bold text-white flex items-center gap-2">
                            <i class="fas fa-search text-blue-500"></i> Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹Ø§Øª
                        </h2>
                        <button onclick="fetchAllData()" class="text-xs text-gray-500 hover:text-white"><i class="fas fa-sync"></i> ØªØ­Ø¯ÙŠØ«</button>
                    </div>
                    <div id="reposContainer" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
                        <div class="col-span-full py-20 text-center text-gray-500 italic">Ø£Ø¯Ø®Ù„ Ø§Ù„Ù€ Token Ù„Ø¹Ø±Ø¶ Ù…Ø´Ø§Ø±ÙŠØ¹Ùƒ</div>
                    </div>
                </div>

                <!-- Uploader Tab -->
                <div id="tab-uploader" class="tab-content space-y-6 max-w-3xl mx-auto">
                    <div class="bg-[#161b22] border border-[#30363d] p-6 rounded-2xl shadow-xl space-y-6">
                        <div class="flex items-center gap-4 border-b border-[#30363d] pb-4">
                            <div class="bg-blue-500/10 p-3 rounded-xl"><i class="fas fa-cloud-upload-alt text-blue-500 text-2xl"></i></div>
                            <div>
                                <h2 class="text-lg font-bold text-white">Ø§Ù„Ø±ÙØ¹ Ø§Ù„Ø°ÙƒÙŠ (Push)</h2>
                                <p class="text-[11px] text-gray-500">Ø±ÙØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª Ù…Ø¨Ø§Ø´Ø±Ø© Ù…Ø¹ Ù…Ø¹Ø§Ù„Ø¬Ø© ZIP ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹</p>
                            </div>
                        </div>

                        <div id="uploaderStatus" class="bg-yellow-500/10 border border-yellow-500/30 p-3 rounded-xl flex items-center gap-3 text-yellow-500 text-xs font-bold">
                            <i class="fas fa-exclamation-triangle"></i> Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ù…Ø³ØªÙˆØ¯Ø¹ Ø£ÙˆÙ„Ø§Ù‹ Ù…Ù† ØµÙØ­Ø© "Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹Ø§Øª"
                        </div>

                        <div class="space-y-4">
                            <label id="dropZone" class="block border-2 border-dashed border-[#30363d] rounded-2xl p-10 text-center hover:border-blue-500 transition-all cursor-pointer">
                                <i class="fas fa-file-archive text-4xl text-gray-600 mb-3 block"></i>
                                <span class="text-sm text-gray-300 font-bold block">Ø§Ø¶ØºØ· Ù„Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„ÙØ§Øª Ø£Ùˆ ZIP</span>
                                <span class="text-[10px] text-gray-500 mt-1 block">ÙŠÙ…ÙƒÙ†Ùƒ Ø±ÙØ¹ Ù…Ù„ÙØ§Øª Ù…ØªØ¹Ø¯Ø¯Ø© Ù…Ø¹Ø§Ù‹</span>
                                <input type="file" id="fileInput" multiple class="hidden" onchange="handleFileSelection(this.files)">
                            </label>

                            <div class="flex items-center justify-between p-4 bg-[#0d1117] rounded-xl border border-[#30363d]">
                                <div class="flex items-center gap-3">
                                    <label class="relative inline-flex items-center cursor-pointer">
                                        <input type="checkbox" id="wipeRepoCheck" class="sr-only peer">
                                        <div class="w-9 h-5 bg-gray-700 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:bg-red-600"></div>
                                    </label>
                                    <div>
                                        <div class="text-xs font-bold text-white">ØªÙØ¹ÙŠÙ„ Wipe Content</div>
                                        <div class="text-[9px] text-gray-500">Ø­Ø°Ù Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹ Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© Ù‚Ø¨Ù„ Ø§Ù„Ø±ÙØ¹</div>
                                    </div>
                                </div>
                                <i class="fas fa-trash-alt text-gray-700"></i>
                            </div>

                            <button onclick="startUploadProcess()" id="btnStartUpload" class="w-full bg-[#238636] hover:bg-[#2ea043] py-3 rounded-xl font-bold text-white shadow-lg disabled:opacity-30 disabled:cursor-not-allowed">
                                ØªÙ†ÙÙŠØ° Ø§Ù„Ø±ÙØ¹ Ø§Ù„Ø¢Ù†
                            </button>
                        </div>
                    </div>

                    <!-- New Repo Form -->
                    <div class="bg-[#161b22] border border-[#30363d] p-6 rounded-2xl shadow-xl">
                        <h2 class="text-md font-bold text-white mb-4 flex items-center gap-2"><i class="fas fa-plus-circle text-blue-500"></i> Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø³ØªÙˆØ¯Ø¹ Ø¬Ø¯ÙŠØ¯</h2>
                        <div class="flex flex-col sm:flex-row gap-3">
                            <input type="text" id="newRepoName" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø´Ø±ÙˆØ¹..." class="flex-1 bg-[#0d1117] border border-[#30363d] rounded-xl px-4 py-2 text-sm text-white">
                            <button onclick="createNewRepo()" class="bg-blue-600 hover:bg-blue-500 px-6 py-2 rounded-xl font-bold text-white text-sm">Ø¥Ù†Ø´Ø§Ø¡</button>
                        </div>
                    </div>
                </div>

                <!-- Gists Tab -->
                <div id="tab-gists" class="tab-content space-y-4">
                    <h2 class="text-lg font-bold text-white px-1">Ø§Ù„Ù‚ØµØ§ØµØ§Øª Ø§Ù„Ø¨Ø±Ù…Ø¬ÙŠØ© (Gists)</h2>
                    <div id="gistsContainer" class="grid grid-cols-1 gap-3">
                        <!-- Injected by JS -->
                    </div>
                </div>

                <!-- Settings Tab -->
                <div id="tab-settings" class="tab-content max-w-2xl mx-auto">
                    <div class="bg-[#161b22] border border-[#30363d] p-6 rounded-2xl">
                        <h2 class="text-lg font-bold text-white mb-6 border-b border-[#30363d] pb-4">Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚</h2>
                        <div class="space-y-6">
                            <div class="flex justify-between items-center">
                                <div>
                                    <div class="text-sm font-bold">Ø§Ù„Ø®ØµÙˆØµÙŠØ© ÙˆØ§Ù„Ø£Ù…Ø§Ù†</div>
                                    <div class="text-[10px] text-gray-500">Ù…Ø³Ø­ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø®Ø²Ù†Ø© Ù…Ø­Ù„ÙŠØ§Ù‹</div>
                                </div>
                                <button onclick="clearAppData()" class="text-red-500 text-xs font-bold hover:underline">Ù…Ø³Ø­ Ø§Ù„ØªÙˆÙƒÙ†</button>
                            </div>
                            <div class="flex justify-between items-center border-t border-[#30363d] pt-6">
                                <div class="text-[10px] text-gray-500">GitHub Manager Ultra - Stable v1.1</div>
                                <div class="text-[10px] text-gray-600">Created for Mobile Efficiency</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Global Terminal -->
            <div class="fixed bottom-0 left-0 right-0 md:left-0 md:right-0 bg-[#010409] border-t border-[#30363d] z-40 terminal-height transition-all duration-300" 
                 id="terminalContainer" style="margin-right: 0px;">
                <div class="bg-[#161b22] px-4 py-1.5 flex justify-between items-center border-b border-[#30363d]">
                    <span class="text-[9px] font-mono font-bold text-gray-500 uppercase flex items-center gap-2 tracking-widest">
                        <i class="fas fa-terminal"></i> Terminal Output
                    </span>
                    <div class="flex items-center gap-3">
                        <button onclick="clearLogs()" class="text-[9px] text-gray-500 hover:text-white uppercase font-bold">Clear</button>
                        <div class="flex gap-1.5">
                            <div class="w-2.5 h-2.5 rounded-full bg-red-500/40"></div>
                            <div class="w-2.5 h-2.5 rounded-full bg-yellow-500/40"></div>
                            <div class="w-2.5 h-2.5 rounded-full bg-green-500/40"></div>
                        </div>
                    </div>
                </div>
                <div id="terminal" class="p-3 terminal-font text-[10px] md:text-[11px] overflow-y-auto h-[calc(100%-35px)] custom-scroll">
                    <!-- Logs appear here -->
                </div>
            </div>
        </main>
    </div>

    <!-- Mobile Token Modal -->
    <div id="tokenModal" class="fixed inset-0 bg-black/80 z-[60] hidden flex items-center justify-center p-6 backdrop-blur-sm">
        <div class="bg-[#161b22] border border-[#30363d] p-6 rounded-2xl w-full max-w-sm space-y-4 shadow-2xl">
            <h3 class="text-white font-bold text-center">Ø£Ø¯Ø®Ù„ Ø±Ù…Ø² Ø§Ù„Ø¯Ø®ÙˆÙ„ (Token)</h3>
            <input type="password" id="tokenInputMobile" class="w-full bg-[#0d1117] border border-[#30363d] rounded-xl px-4 py-3 text-white text-center" placeholder="ghp_xxxxxx">
            <button onclick="validateTokenFromModal()" class="w-full bg-blue-600 py-3 rounded-xl text-white font-bold">Ø§ØªØµØ§Ù„ Ø§Ù„Ø¢Ù†</button>
            <button onclick="closeTokenModal()" class="w-full py-2 text-gray-500 text-sm">Ø¥Ù„ØºØ§Ø¡</button>
        </div>
    </div>

    <script>
        // --- State Management ---
        const state = {
            token: localStorage.getItem('gh_token') || '',
            user: null,
            repos: [],
            selectedRepo: null,
            activeTab: 'dashboard',
            filesToUpload: []
        };

        const elements = {
            terminal: document.getElementById('terminal'),
            sidebar: document.getElementById('sidebar'),
            backdrop: document.getElementById('sidebarBackdrop'),
            tokenInput: document.getElementById('tokenInput'),
            uploaderStatus: document.getElementById('uploaderStatus'),
            btnStartUpload: document.getElementById('btnStartUpload')
        };

        // --- Core Functions ---
        
        window.onload = () => {
            if (state.token) {
                elements.tokenInput.value = state.token;
                validateToken();
            }
            adjustTerminalWidth();
            log("Ø§Ù„Ù†Ø¸Ø§Ù… Ø¬Ø§Ù‡Ø² Ù„Ù„Ø¹Ù…Ù„ Ø¹Ù„Ù‰ Ø§Ù„Ù…ØªØµÙØ­ ÙˆØ§Ù„Ù‡Ø§ØªÙ.", "info");
        };

        window.onresize = adjustTerminalWidth;

        function adjustTerminalWidth() {
            const sidebar = document.getElementById('sidebar');
            const terminal = document.getElementById('terminalContainer');
            if (window.innerWidth >= 768) {
                terminal.style.marginRight = "16rem";
            } else {
                terminal.style.marginRight = "0";
            }
        }

        function toggleSidebar() {
            elements.sidebar.classList.toggle('translate-x-full');
            elements.backdrop.classList.toggle('hidden');
        }

        function log(msg, type = 'info') {
            const time = new Date().toLocaleTimeString([], { hour12: false });
            const div = document.createElement('div');
            div.className = "mb-1 leading-relaxed";
            
            let color = "text-blue-400";
            if(type === 'error') color = "text-red-500 font-bold";
            if(type === 'success') color = "text-green-500";
            if(type === 'warning') color = "text-yellow-500";

            div.innerHTML = `<span class="text-gray-600">[${time}]</span> <span class="${color}">${msg}</span>`;
            elements.terminal.appendChild(div);
            elements.terminal.scrollTop = elements.terminal.scrollHeight;
        }

        function clearLogs() {
            elements.terminal.innerHTML = "";
            log("ØªÙ… Ù…Ø³Ø­ Ø§Ù„Ø³Ø¬Ù„Ø§Øª.", "info");
        }

        function showTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(b => b.classList.remove('active-tab'));
            
            document.getElementById(`tab-${tabId}`).classList.add('active');
            document.getElementById(`btn-${tabId}`).classList.add('active-tab');
            state.activeTab = tabId;

            if (window.innerWidth < 768) toggleSidebar();
        }

        async function githubFetch(endpoint, options = {}) {
            const url = `https://api.github.com/${endpoint}`;
            const headers = {
                'Authorization': `token ${state.token}`,
                'Accept': 'application/vnd.github.v3+json',
                ...options.headers
            };
            return fetch(url, { ...options, headers });
        }

        async function validateToken() {
            const val = elements.tokenInput.value.trim();
            if(!val) return log("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„ØªÙˆÙƒÙ†.", "error");
            
            state.token = val;
            const icon = document.getElementById('syncIcon');
            icon.classList.add('animate-spin');

            try {
                const res = await githubFetch('user');
                if (res.ok) {
                    state.user = await res.json();
                    localStorage.setItem('gh_token', state.token);
                    updateUIWithUser();
                    log(`ØªÙ… Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù†Ø¬Ø§Ø­ Ø¨Ø§Ù„Ø­Ø³Ø§Ø¨: ${state.user.login}`, "success");
                    fetchAllData();
                } else {
                    log("ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„. Ø§Ù„ØªÙˆÙƒÙ† ØºÙŠØ± ØµØ§Ù„Ø­ Ø£Ùˆ Ù…Ù†ØªÙ‡ÙŠ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ©.", "error");
                    state.token = "";
                }
            } catch (err) {
                log(`Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø´Ø¨ÙƒØ©: ${err.message}`, "error");
            } finally {
                icon.classList.remove('animate-spin');
            }
        }

        function updateUIWithUser() {
            const u = state.user;
            document.getElementById('sidebarUser').classList.remove('hidden');
            document.getElementById('userAvatar').src = u.avatar_url;
            document.getElementById('userLogin').innerText = u.login;

            // Stats
            document.getElementById('stat-repos').innerText = u.public_repos;
            document.getElementById('stat-followers').innerText = u.followers;
            document.getElementById('stat-stars').innerText = u.public_gists; // Just a placeholder

            // Dashboard Card
            const cardHtml = `
                <img src="${u.avatar_url}" class="w-32 h-32 rounded-3xl border-4 border-[#30363d] shadow-2xl">
                <div class="text-right flex-1 space-y-2">
                    <h1 class="text-2xl font-bold text-white">${u.name || u.login}</h1>
                    <p class="text-xs text-gray-400 max-w-md">${u.bio || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙˆØµÙ Ù…ØªØ§Ø­.'}</p>
                    <div class="flex gap-3 pt-2">
                        <span class="bg-[#0d1117] px-3 py-1 rounded-lg border border-[#30363d] text-[10px]">ğŸ“ ${u.location || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</span>
                        <span class="bg-[#0d1117] px-3 py-1 rounded-lg border border-[#30363d] text-[10px]">ğŸ“… Ø§Ù†Ø¶Ù… ÙÙŠ: ${new Date(u.created_at).getFullYear()}</span>
                    </div>
                </div>
            `;
            document.getElementById('userCard').innerHTML = cardHtml;
            document.getElementById('userCardMobile').innerHTML = cardHtml;
        }

        async function fetchAllData() {
            if(!state.token) return;
            try {
                const [reposRes, gistsRes] = await Promise.all([
                    githubFetch('user/repos?sort=updated&per_page=100'),
                    githubFetch('gists')
                ]);

                if(reposRes.ok) {
                    state.repos = await reposRes.json();
                    renderRepos();
                }
                if(gistsRes.ok) {
                    const gists = await gistsRes.json();
                    document.getElementById('stat-gists').innerText = gists.length;
                    renderGists(gists);
                }
            } catch (e) { log("Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.", "error"); }
        }

        function renderRepos() {
            const container = document.getElementById('reposContainer');
            if(state.repos.length === 0) {
                container.innerHTML = `<div class="col-span-full py-10 text-center text-gray-500">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø³ØªÙˆØ¯Ø¹Ø§Øª.</div>`;
                return;
            }

            container.innerHTML = state.repos.map(r => `
                <div class="bg-[#161b22] border border-[#30363d] p-4 rounded-xl hover:border-blue-500 transition-all flex flex-col justify-between group">
                    <div>
                        <div class="flex justify-between items-start mb-2">
                            <h3 class="font-bold text-white text-sm truncate w-32">${r.name}</h3>
                            <div class="flex gap-2">
                                <button onclick="downloadZip('${r.owner.login}', '${r.name}')" class="text-gray-500 hover:text-white"><i class="fas fa-download text-xs"></i></button>
                                <button onclick="selectRepoById(${r.id})" class="text-blue-500"><i class="fas fa-plus-circle text-xs"></i></button>
                            </div>
                        </div>
                        <p class="text-[10px] text-gray-500 line-clamp-2 mb-3 h-8">${r.description || 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙˆØµÙ.'}</p>
                    </div>
                    <div class="flex justify-between items-center text-[9px] text-gray-600 font-bold uppercase">
                        <span><i class="fas fa-circle text-blue-500 text-[6px]"></i> ${r.language || 'Plain'}</span>
                        <span>${new Date(r.updated_at).toLocaleDateString()}</span>
                    </div>
                </div>
            `).join('');
        }

        function renderGists(gists) {
            const container = document.getElementById('gistsContainer');
            container.innerHTML = gists.map(g => `
                <div class="bg-[#161b22] border border-[#30363d] p-4 rounded-xl flex items-center justify-between">
                    <div class="flex items-center gap-3">
                        <i class="fas fa-code text-purple-500"></i>
                        <div>
                            <div class="text-xs font-bold text-white">${Object.keys(g.files)[0]}</div>
                            <div class="text-[9px] text-gray-600">${new Date(g.updated_at).toLocaleDateString()}</div>
                        </div>
                    </div>
                    <a href="${g.html_url}" target="_blank" class="text-blue-500"><i class="fas fa-external-link-alt"></i></a>
                </div>
            `).join('');
        }

        function selectRepoById(id) {
            const repo = state.repos.find(r => r.id === id);
            if(repo) {
                state.selectedRepo = repo;
                document.getElementById('currentRepoBadge').classList.remove('hidden');
                document.getElementById('selectedRepoName').innerText = repo.name;
                document.getElementById('uploaderStatus').classList.add('hidden');
                elements.btnStartUpload.disabled = false;
                log(`ØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹ Ù„Ù„Ø¹Ù…Ù„: ${repo.name}`, "info");
                showTab('uploader');
            }
        }

        function deselectRepo() {
            state.selectedRepo = null;
            document.getElementById('currentRepoBadge').classList.add('hidden');
            document.getElementById('uploaderStatus').classList.remove('hidden');
            elements.btnStartUpload.disabled = true;
        }

        async function downloadZip(owner, repo) {
            log(`Ø¬Ø§Ø±ÙŠ Ø·Ù„Ø¨ Ù…Ù„Ù ZIP Ù„Ù€ ${repo}...`, "warning");
            const res = await githubFetch(`repos/${owner}/${repo}/zipball/main`);
            if(res.ok) {
                const blob = await res.blob();
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `${repo}.zip`;
                a.click();
                log(`ØªÙ… ØªØ­Ù…ÙŠÙ„ ${repo} Ø¨Ù†Ø¬Ø§Ø­.`, "success");
            } else {
                log("ÙØ´Ù„ Ø§Ù„ØªØ­Ù…ÙŠÙ„. Ø±Ø¨Ù…Ø§ Ø§Ø³Ù… Ø§Ù„ÙØ±Ø¹ Ù„ÙŠØ³ 'main'.", "error");
            }
        }

        // --- Upload Logic ---

        function handleFileSelection(files) {
            state.filesToUpload = Array.from(files);
            log(`ØªÙ… Ø§Ø®ØªÙŠØ§Ø± ${files.length} Ù…Ù„Ù/Ù…Ù„ÙØ§Øª Ù„Ù„Ø±ÙØ¹.`, "info");
        }

        async function startUploadProcess() {
            if(!state.selectedRepo || state.filesToUpload.length === 0) return;
            
            const owner = state.selectedRepo.owner.login;
            const repo = state.selectedRepo.name;
            const shouldWipe = document.getElementById('wipeRepoCheck').checked;

            elements.btnStartUpload.disabled = true;
            elements.btnStartUpload.innerText = "Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªÙ†ÙÙŠØ°...";

            if(shouldWipe) {
                log("ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø³Ø­ Ù…ÙØ¹Ù„: Ø¬Ø§Ø±ÙŠ ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹...", "warning");
                await wipeRepo(owner, repo);
            }

            for(const file of state.filesToUpload) {
                if(file.name.toLowerCase().endsWith('.zip')) {
                    await processZipAndUpload(file, owner, repo);
                } else {
                    await uploadToGithub(file.name, file, owner, repo);
                }
            }

            log("Ø§ÙƒØªÙ…Ù„Øª Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø¨Ù†Ø¬Ø§Ø­.", "success");
            elements.btnStartUpload.disabled = false;
            elements.btnStartUpload.innerText = "ØªÙ†ÙÙŠØ° Ø§Ù„Ø±ÙØ¹ Ø§Ù„Ø¢Ù†";
            state.filesToUpload = [];
            fetchAllData();
        }

        async function wipeRepo(owner, repo) {
            try {
                const res = await githubFetch(`repos/${owner}/${repo}/git/trees/main?recursive=1`);
                if(!res.ok) return;
                const data = await res.json();
                const blobs = data.tree.filter(i => i.type === 'blob');
                for(const b of blobs) {
                    await githubFetch(`repos/${owner}/${repo}/contents/${b.path}`, {
                        method: 'DELETE',
                        body: JSON.stringify({ message: "Wipe before sync", sha: b.sha })
                    });
                }
                log(`ØªÙ… Ø­Ø°Ù ${blobs.length} Ù…Ù„Ù Ù‚Ø¯ÙŠÙ….`, "success");
            } catch(e) { log("Ø®Ø·Ø£ ÙÙŠ Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ù…Ø³Ø­.", "error"); }
        }

        async function processZipAndUpload(zipFile, owner, repo) {
            log(`ÙÙƒ Ø¶ØºØ·: ${zipFile.name}...`, "warning");
            const zip = new JSZip();
            const contents = await zip.loadAsync(zipFile);
            let entries = [];
            zip.forEach((path, entry) => { if(!entry.dir) entries.push({path, entry}); });

            // Root folder detection
            if(entries.length > 0) {
                const rootCandidate = entries[0].path.split('/')[0];
                const allShare = entries.every(e => e.path.startsWith(rootCandidate + '/'));
                if(allShare) {
                    log(`ØªØ¬Ø§Ù‡Ù„ Ø§Ù„Ù…Ø¬Ù„Ø¯ Ø§Ù„Ø­Ø§ÙˆÙŠ: ${rootCandidate}`, "warning");
                    entries = entries.map(e => ({...e, path: e.path.substring(rootCandidate.length + 1)}));
                }
            }

            for(const item of entries) {
                const blob = await item.entry.async("blob");
                await uploadToGithub(item.path, blob, owner, repo);
            }
        }

        async function uploadToGithub(path, content, owner, repo) {
            log(`Ø±ÙØ¹: ${path}`);
            const base64 = await toBase64(content);
            const cleanBase64 = base64.split(',')[1];
            const url = `repos/${owner}/${repo}/contents/${path}`;

            let sha = null;
            try {
                const check = await githubFetch(url);
                if(check.ok) {
                    const data = await check.json();
                    sha = data.sha;
                }
            } catch(e) {}

            const res = await githubFetch(url, {
                method: 'PUT',
                body: JSON.stringify({ message: `Upload ${path}`, content: cleanBase64, sha })
            });

            if(res.ok) log(`Ù†Ø¬Ø§Ø­: ${path}`, "success");
            else log(`ÙØ´Ù„: ${path}`, "error");
        }

        function toBase64(file) {
            return new Promise((r, j) => {
                const reader = new FileReader();
                reader.onload = () => r(reader.result);
                reader.readAsDataURL(file);
            });
        }

        async function createNewRepo() {
            const name = document.getElementById('newRepoName').value.trim();
            if(!name || !state.token) return;
            log(`Ø¬Ø§Ø±ÙŠ Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø³ØªÙˆØ¯Ø¹ Ø¨Ø§Ø³Ù…: ${name}...`, "info");
            const res = await githubFetch('user/repos', {
                method: 'POST',
                body: JSON.stringify({ name, auto_init: true })
            });
            if(res.ok) {
                log(`ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹ Ø¨Ù†Ø¬Ø§Ø­!`, "success");
                document.getElementById('newRepoName').value = "";
                fetchAllData();
            } else {
                log("ÙØ´Ù„ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹.", "error");
            }
        }

        // --- UI Utilities ---
        function clearAppData() {
            localStorage.removeItem('gh_token');
            location.reload();
        }

        function openTokenModal() { document.getElementById('tokenModal').classList.remove('hidden'); }
        function closeTokenModal() { document.getElementById('tokenModal').classList.add('hidden'); }
        function validateTokenFromModal() {
            elements.tokenInput.value = document.getElementById('tokenInputMobile').value;
            validateToken();
            closeTokenModal();
        }

    </script>
</body>
</html>

